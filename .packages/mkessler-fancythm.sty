\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mkessler-fancythm}[2021/04/27 - Theorem-Environment Package]
%%%%%%%%m
%Provides fancy theorem-like-environments usedd in the write-ups of my lecture nots

\newif\ifenglish\englishtrue
\DeclareOption{english}{\englishtrue}
\DeclareOption{german}{\englishfalse}
\DeclareOption*{\PackageWarning{mkessler-fancythm}{Unknown '\CurrentOption'}}

\ProcessOptions\relax


%%(Optional) Options for layout of the environments
\RequirePackage{xkeyval}
\newcommand{\fancythmlinewidth}{2pt}
\newcommand{\fancythmskipabove}{8pt}

\DeclareOptionX{linewidth}{\renewcommand\fancythmlinewidth{#1}}
\DeclareOption{\fancythmskipabove}{\renewcommand{\fancythmskipabove}{#1}}
\DeclareOptionX*{\PackageWarning{mkessler-fancythm}{Unknown `\CurrentOption'}}% For unknown options

\ProcessOptionsX*\relax

%Required Packages
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{mdframed}
\RequirePackage{thmtools}
\RequirePackage[colorlinks]{hyperref}
\RequirePackage{cleveref}
\RequirePackage[skins]{tcolorbox}
%\RequirePackage[usenames,svgnames,dvipsnames]{xcolor}
\mdfsetup{skipabove=\topskip,skipbelow=\topskip}

%%mdframed styles
\mdfdefinestyle{mdredmargin}{%
    skipabove =\fancythmskipabove,
    linecolor=red,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    backgroundcolor=red!8,
    rightline=false,
    topline=false,
    bottomline=false
}

\mdfdefinestyle{mdorangemargin}{%
    skipabove =\fancythmskipabove,
    linecolor=orange,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    backgroundcolor=orange!10,
    rightline=false,
    topline=false,
    bottomline=false
}

\mdfdefinestyle{mdbluemargin}{%
    skipabove =\fancythmskipabove,
    linecolor=blue,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    backgroundcolor=blue!7,
    rightline=false,
    topline=false,
    bottomline=false
}

\mdfdefinestyle{mdgreenmargin}{%
    skipabove =\fancythmskipabove,
    linecolor=green!70!black,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    rightline=false,
    topline=false,
    bottomline=false
}

\mdfdefinestyle{mdyellowmargin}{%
    skipabove =\fancythmskipabove,
    linecolor=yellow!80!orange,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    rightline=false,
    topline=false,
    bottomline=false
}

\mdfdefinestyle{mdvioletmargin}{%
    skipabove =\fancythmskipabove,
    linecolor=violet,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    backgroundcolor=violet!7,
    rightline=false,
    topline=false,
    bottomline=false
}


\mdfdefinestyle{mdredmarginbluefill}{%
    skipabove =\fancythmskipabove,
    linecolor=red,
    linewidth = \fancythmlinewidth,
    leftmargin = 0cm,
    rightmargin=0cm,
    backgroundcolor=blue!7,
    rightline=false,
    topline=false,
    bottomline=false
}

\declaretheoremstyle[
	mdframed={style=mdredmargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmredmargin}

\declaretheoremstyle[
	mdframed={style=mdorangemargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmorangemargin}

\declaretheoremstyle[
	mdframed={style=mdbluemargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmbluemargin}


\declaretheoremstyle[
	mdframed={style=mdgreenmargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmgreenmargin}

\declaretheoremstyle[
	mdframed={style=mdyellowmargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmyellowmargin}

\declaretheoremstyle[
	mdframed={style=mdvioletmargin},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmvioletmargin}


\declaretheoremstyle[
	mdframed={style=mdredmarginbluefill},
	postheadspace={0.3em},
    notefont=\mdseries
]{thmredmarginbluefill}


%Theorem
\global\declaretheorem[style=thmredmargin,name=\ifenglish Theorem\else Satz\fi,numberwithin=section, refname = {Satz,Sätze}, Refname = {Satz,Sätze}]{theorem}

%Unnumbered Theorem
\declaretheorem[style=thmredmargin,name=\ifenglish Theorem\else Satz\fi,numbered=no]{theorem*}

%Proposition
\declaretheorem[style=thmredmargin,name=Proposition,sibling=theorem]{proposition}

%Unnumbered Proposition
\declaretheorem[style=thmredmargin,name=Proposition,numbered=no]{proposition*}

%Corollary
\declaretheorem[style=thmredmargin,name=\ifenglish Corollary\else Korollar\fi,sibling=theorem]{corollary}

%Unnumbered Corollary
\declaretheorem[style=thmredmargin,name=\ifenglish Corollary\else Korollar\fi,numbered=no]{corollary*}

%Lemma
\declaretheorem[style=thmorangemargin,name=Lemma,sibling=theorem]{lemma}

%Unnumbered Lemma
\declaretheorem[style=thmorangemargin,name=Lemma,,numbered=no]{lemma*}

%Definition
\declaretheorem[style=thmbluemargin,name=Definition]{definition}

%unnumbered Definition
\declaretheorem[style=thmbluemargin,name=Definition,numbered=no]{definition*}

%Theorem + Definition
\declaretheorem[style=thmredmarginbluefill,name=\ifenglish Theorem and Definition\else Satz und Definition\fi,sibling=theorem]{theoremdef}

%Notation
\declaretheorem[style=thmvioletmargin,name=Notation,numbered=no]{notation}

%Example
\declaretheorem[style=thmgreenmargin,name=\ifenglish Example\else Beispiel\fi,numbered=no]{example}

%Remark
\declaretheorem[style=thmyellowmargin,name=\ifenglish Remark\else Bemerkung\fi,numbered=no]{remark}



\newtcolorbox{recap}{before skip = 0.5cm, after skip = 0.5cm, enhanced, sharp corners = all, colback = white, colframe = gray, toprule=0pt, bottomrule=0pt, leftrule=0pt,rightrule=0pt, overlay = {
        \draw[gray, line width = 2pt] (frame.north west) -- ++(0.5cm, 0pt);
        \draw[gray, line width=2pt] (frame.south east) -- ++(-0.5cm, 0pt);
        \draw[gray, line width=2pt] (frame.north west) -- ++ (0pt, -0.5cm);
        \draw[gray, line width=2pt] (frame.south east) -- ++(0pt, 0.5cm);
}}



\theoremstyle{plain}
\newtheorem{variant}{\ifenglish Variant\else Variante\fi}
\newtheorem{assumption}{\ifenglish Assumption\else Annahme\fi}

%%Give claim an own counter and let it reset at each proof
%See also at:
%https://tex.stackexchange.com/questions/283502/reset-counter-at-beginning-of-proof
\newtheorem{claim}{\ifenglish Claim\else Behauptung\fi}
\AtBeginEnvironment{proof}{\setcounter{claim}{0}}

\theoremstyle{definition}
\newtheorem*{fact}{\ifenglish Fact\else Fakt\fi}
\newtheorem*{note}{\ifenglish Note\else Anmerkung\fi}
\newtheorem*{warning}{\color{red}\ifenglish Warning \else Warnung\fi}
\newtheorem*{goal}{\ifenglish Goal \else Ziel\fi}
\newtheorem*{question}{\ifenglish Question \else Frage \fi}
\newtheorem*{problem}{Problem}
\newtheorem*{info}{Information}
\newtheorem*{moral}{Moral}
\newtheorem*{answer}{\ifenglish Answer\else Antwort\fi}
\newtheorem*{observe}{\ifenglish Observe\else Beobachte\fi}
\newtheorem*{property}{\ifenglish Property\else Eigenschaft\fi}
\newtheorem*{intuition}{Intuition}
\newtheorem*{recall}{\ifenglish Recall\else Erinnerung\fi}
\newtheorem*{idea}{\ifenglish Idea\else Idee\fi}
\newtheorem{exercise}{\ifenglish Exercise\else Aufgabe\fi}


%%subproof environment - essentially copied proof environment from amsthm and modified its name + symbol
\makeatletter
\DeclareRobustCommand{\blackqed}{%
  \ifmmode \mathqed
  \else
    \leavevmode\unskip\penalty9999 \hbox{}\nobreak\hfill
    \quad\hbox{$\blacksquare$}%
  \fi
}
\newenvironment{subproof}[1][\ifenglish Subproof\else Unterbeweis\fi]{\par
  \pushQED{\blackqed}%
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
        \itshape
    #1\@addpunct{.}]\ignorespaces
}{%
  \popQED\endtrivlist\@endpefalse
}
\makeatother

\newenvironment{solution}[1][]{\begin{proof}[\ifenglish{}Solution\else{}Lösung\fi{}#1]}{\end{proof}}
